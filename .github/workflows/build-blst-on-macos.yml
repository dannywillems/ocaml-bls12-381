# If you update the build.sh flags, you must also update src/blst/dune accordingly
on: [push]
jobs:
  # Not supporting clang 10
  # Getting error:
  # > ld: unsupported tapi file type '!tapi-tbd' in YAML file
  # > '/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/lib/libSystem.tbd'
  # > for architecture x86_64
  # > clang: error: linker command failed with exit code 1 (use -v to see invocation)

  # blst-build-clang-10:
  #   runs-on: [macos-10.15]
  #   steps:
  #     - uses: actions/checkout@v2
  #     - run: |
  #         sudo xcode-select -s /Applications/Xcode_10.3.app/Contents/Developer
  #         cc --version
  #         cd src/blst/libblst && ./build.sh -shared -Wno-missing-braces

  blst-build-clang-11:
    name: Build blst on MacOS clang11
    runs-on: macos-10.15
    steps:
      - uses: actions/checkout@v2
      - run: |
          sudo xcode-select -s /Applications/Xcode_11.3.app/Contents/Developer
          cc --version
          cd src/blst/libblst && ./build.sh -shared -Wno-missing-braces

  blst-build-clang-12:
    name: Build blst on MacOS clang12
    runs-on: macos-10.15
    steps:
      - uses: actions/checkout@v2
      - run: |
          sudo xcode-select -s /Applications/Xcode_12.app/Contents/Developer
          cc --version
          cd src/blst/libblst && ./build.sh -shared -Wno-missing-braces

  test-build:
    name: Build the whole library and run test on s390x
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2.1.0
      - uses: uraimo/run-on-arch-action@v2.1.1
        name: build on s390x
        with:
          arch: s390x
          distro: ubuntu20.04

          run: |
            uname --machine



